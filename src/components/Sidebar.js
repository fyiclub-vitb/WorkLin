import { jsx as _jsx, jsxs as _jsxs, Fragment as _Fragment } from "react/jsx-runtime";
import { Plus, Search, Settings, X, FileText, Home, Star, Trash2, Moon, Sun } from 'lucide-react';
import { useNavigate } from 'react-router-dom';
import { motion, AnimatePresence } from 'framer-motion';
import { useDarkMode } from '../hooks/useDarkMode';
import { IconPicker } from './ui/icon-picker';
import { usePageSearch } from '../hooks/use-page-search';
const HighlightedText = ({ text, highlight }) => {
    if (!highlight.trim()) {
        return _jsx("span", { className: "truncate", children: text });
    }
    // Escape regex special characters
    const escapedHighlight = highlight.replace(/[.*+?^${}()|[\]\\]/g, '\\$&');
    const parts = text.split(new RegExp(`(${escapedHighlight})`, 'gi'));
    return (_jsx("span", { className: "truncate", children: parts.map((part, i) => part.toLowerCase() === highlight.toLowerCase() ? (_jsx("span", { className: "bg-yellow-200 dark:bg-yellow-900/50 text-gray-900 dark:text-gray-100 rounded-[2px] px-0.5", children: part }, i)) : (_jsx("span", { children: part }, i))) }));
};
export const Sidebar = ({ pages, currentPageId, onSelectPage, onAddPage, onDeletePage, onUpdatePage, sidebarOpen, setSidebarOpen, }) => {
    const navigate = useNavigate();
    const { isDark, toggleDarkMode } = useDarkMode();
    // Using the hook to manage search state and results
    const { searchQuery, setSearchQuery, filteredPages, inputRef } = usePageSearch(pages);
    return (_jsxs(_Fragment, { children: [_jsx(AnimatePresence, { children: sidebarOpen && (_jsx(motion.div, { initial: { opacity: 0 }, animate: { opacity: 1 }, exit: { opacity: 0 }, onClick: () => setSidebarOpen(false), className: "fixed inset-0 bg-black/50 z-40 lg:hidden" })) }), _jsxs(motion.aside, { initial: false, animate: { x: sidebarOpen ? 0 : -280 }, transition: { type: 'spring', damping: 25, stiffness: 200 }, className: "fixed lg:static inset-y-0 left-0 z-50 w-64 bg-[#f7f6f3] dark:bg-[#1e1e1e] border-r border-gray-200 dark:border-gray-800 flex flex-col h-screen", children: [_jsxs("div", { className: "p-3 border-b border-gray-200 dark:border-gray-800 flex items-center justify-between", children: [_jsxs("div", { className: "flex items-center gap-2", children: [_jsx("div", { className: "w-8 h-8 rounded bg-gradient-to-br from-blue-500 to-purple-600 flex items-center justify-center text-white font-bold text-sm", children: "W" }), _jsx("span", { className: "font-semibold text-gray-900 dark:text-gray-100", children: "WorkLin" })] }), _jsx("button", { onClick: () => setSidebarOpen(false), className: "lg:hidden p-1.5 hover:bg-gray-200 dark:hover:bg-gray-700 rounded", children: _jsx(X, { size: 18 }) })] }), _jsxs("div", { className: "p-2 space-y-1", children: [_jsxs("button", { onClick: onAddPage, className: "w-full flex items-center gap-2 px-3 py-2 text-sm text-gray-700 dark:text-gray-300 hover:bg-gray-100 dark:hover:bg-gray-800 rounded-md transition-colors group", children: [_jsx(Plus, { size: 16, className: "text-gray-500 group-hover:text-gray-700 dark:text-gray-400" }), _jsx("span", { children: "New Page" })] }), _jsxs("button", { onClick: () => inputRef.current?.focus(), className: "w-full flex items-center gap-2 px-3 py-2 text-sm text-gray-700 dark:text-gray-300 hover:bg-gray-100 dark:hover:bg-gray-800 rounded-md transition-colors", children: [_jsx(Search, { size: 16, className: "text-gray-500" }), _jsx("span", { children: "Search" }), _jsx("span", { className: "ml-auto text-xs text-gray-400", children: "\u2318K" })] })] }), _jsx("div", { className: "px-2 pb-2", children: _jsxs("div", { className: "relative", children: [_jsx(Search, { size: 14, className: "absolute left-2 top-1/2 -translate-y-1/2 text-gray-400" }), _jsx("input", { ref: inputRef, type: "text", placeholder: "Search pages...", value: searchQuery, onChange: (e) => setSearchQuery(e.target.value), className: "w-full pl-8 pr-3 py-1.5 text-sm bg-white dark:bg-gray-800 border border-gray-200 dark:border-gray-700 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500 dark:text-gray-100 placeholder:text-gray-400" })] }) }), _jsx("div", { className: "px-2 pb-2", children: _jsxs("div", { className: "space-y-0.5", children: [_jsxs("button", { className: "w-full flex items-center gap-2 px-2 py-1.5 text-sm text-gray-700 dark:text-gray-300 hover:bg-gray-100 dark:hover:bg-gray-800 rounded-md transition-colors", children: [_jsx(Home, { size: 16 }), _jsx("span", { children: "Home" })] }), _jsxs("button", { className: "w-full flex items-center gap-2 px-2 py-1.5 text-sm text-gray-700 dark:text-gray-300 hover:bg-gray-100 dark:hover:bg-gray-800 rounded-md transition-colors", children: [_jsx(Star, { size: 16 }), _jsx("span", { children: "Favorites" })] }), _jsxs("button", { onClick: () => navigate('/app/search'), className: "w-full flex items-center gap-2 px-2 py-1.5 text-sm text-gray-700 dark:text-gray-300 hover:bg-gray-100 dark:hover:bg-gray-800 rounded-md transition-colors", children: [_jsx(Search, { size: 16 }), _jsx("span", { children: "Advanced Search" })] })] }) }), _jsx("div", { className: "flex-1 overflow-y-auto px-2", children: _jsxs("div", { className: "py-2", children: [_jsx("div", { className: "px-2 py-1 text-xs font-semibold text-gray-500 dark:text-gray-400 uppercase tracking-wider", children: searchQuery ? 'Search Results' : 'Pages' }), filteredPages.length === 0 ? (_jsxs("div", { className: "text-center py-8 px-2", children: [_jsx(FileText, { size: 32, className: "mx-auto text-gray-300 dark:text-gray-600 mb-2" }), _jsx("p", { className: "text-sm text-gray-400 dark:text-gray-500", children: searchQuery ? 'No pages found' : 'No pages yet' }), !searchQuery && (_jsx("button", { onClick: onAddPage, className: "mt-2 text-sm text-blue-600 dark:text-blue-400 hover:underline", children: "Create your first page" }))] })) : (_jsx("div", { className: "space-y-0.5", children: filteredPages.map((page) => (_jsxs(motion.div, { whileHover: { x: 2 }, className: `group flex items-center gap-2 px-2 py-1.5 rounded-md cursor-pointer transition-colors ${currentPageId === page.id
                                            ? 'bg-blue-50 dark:bg-blue-900/20 text-blue-700 dark:text-blue-300'
                                            : 'text-gray-700 dark:text-gray-300 hover:bg-gray-100 dark:hover:bg-gray-800'}`, onClick: () => onSelectPage(page.id), children: [_jsx("div", { onClick: (e) => e.stopPropagation(), children: _jsx(IconPicker, { onChange: (icon) => onUpdatePage?.(page.id, icon), children: _jsx("span", { className: "text-base flex-shrink-0 hover:bg-gray-200 dark:hover:bg-gray-700 rounded p-0.5 transition-colors cursor-pointer", children: page.icon }) }) }), _jsx("span", { className: "flex-1 text-sm font-medium truncate", children: _jsx(HighlightedText, { text: page.title, highlight: searchQuery }) }), _jsx("button", { onClick: (e) => {
                                                    e.stopPropagation();
                                                    onDeletePage(page.id);
                                                }, className: "opacity-0 group-hover:opacity-100 p-1 hover:bg-red-100 dark:hover:bg-red-900/30 rounded transition-all text-gray-400 hover:text-red-600 dark:hover:text-red-400", children: _jsx(Trash2, { size: 14 }) })] }, page.id))) }))] }) }), _jsxs("div", { className: "border-t border-gray-200 dark:border-gray-800 p-2 space-y-1", children: [_jsxs("button", { onClick: toggleDarkMode, className: "w-full flex items-center gap-2 px-2 py-1.5 text-sm text-gray-700 dark:text-gray-300 hover:bg-gray-100 dark:hover:bg-gray-800 rounded-md transition-colors", children: [isDark ? _jsx(Sun, { size: 16 }) : _jsx(Moon, { size: 16 }), _jsx("span", { children: isDark ? 'Light Mode' : 'Dark Mode' })] }), _jsxs("button", { className: "w-full flex items-center gap-2 px-2 py-1.5 text-sm text-gray-700 dark:text-gray-300 hover:bg-gray-100 dark:hover:bg-gray-800 rounded-md transition-colors", children: [_jsx(Settings, { size: 16 }), _jsx("span", { children: "Settings" })] })] })] })] }));
};
